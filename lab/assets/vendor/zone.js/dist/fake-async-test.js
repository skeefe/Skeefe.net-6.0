!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";!function(e){var t=function(){function t(){this.nextId=0,this._schedulerQueue=[],this._currentTime=0}return t.prototype.scheduleFunction=function(e,t,r,n){void 0===r&&(r=[]),void 0===n&&(n=-1);for(var i=n<0?this.nextId++:n,s=this._currentTime+t,o={endTime:s,id:i,func:e,args:r,delay:t},u=0;u<this._schedulerQueue.length;u++){var c=this._schedulerQueue[u];if(o.endTime<c.endTime)break}return this._schedulerQueue.splice(u,0,o),i},t.prototype.removeScheduledFunctionWithId=function(e){for(var t=0;t<this._schedulerQueue.length;t++)if(this._schedulerQueue[t].id==e){this._schedulerQueue.splice(t,1);break}},t.prototype.tick=function(t){void 0===t&&(t=0);for(var r=this._currentTime+t;this._schedulerQueue.length>0;){var n=this._schedulerQueue[0];if(r<n.endTime)break;var i=this._schedulerQueue.shift();this._currentTime=i.endTime;var s=i.func.apply(e,i.args);if(!s)break}this._currentTime=r},t}(),r=function(){function r(e){this._scheduler=new t,this._microtasks=[],this._lastError=null,this._uncaughtPromiseErrors=Promise[Zone.__symbol__("uncaughtPromiseErrors")],this.pendingPeriodicTimers=[],this.pendingTimers=[],this.properties={FakeAsyncTestZoneSpec:this},this.name="fakeAsyncTestZone for "+e}return r.assertInZone=function(){if(null==Zone.current.get("FakeAsyncTestZoneSpec"))throw new Error("The code should be running in the fakeAsync zone to call this function")},r.prototype._fnAndFlush=function(t,r){var n=this;return function(){for(var i=[],s=0;s<arguments.length;s++)i[s-0]=arguments[s];return t.apply(e,i),null===n._lastError?(null!=r.onSuccess&&r.onSuccess.apply(e),n.flushMicrotasks()):null!=r.onError&&r.onError.apply(e),null===n._lastError}},r._removeTimer=function(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)},r.prototype._dequeueTimer=function(e){var t=this;return function(){r._removeTimer(t.pendingTimers,e)}},r.prototype._requeuePeriodicTimer=function(e,t,r,n){var i=this;return function(){i.pendingPeriodicTimers.indexOf(n)!==-1&&i._scheduler.scheduleFunction(e,t,r,n)}},r.prototype._dequeuePeriodicTimer=function(e){var t=this;return function(){r._removeTimer(t.pendingPeriodicTimers,e)}},r.prototype._setTimeout=function(e,t,r){var n=this._dequeueTimer(this._scheduler.nextId),i=this._fnAndFlush(e,{onSuccess:n,onError:n}),s=this._scheduler.scheduleFunction(i,t,r);return this.pendingTimers.push(s),s},r.prototype._clearTimeout=function(e){r._removeTimer(this.pendingTimers,e),this._scheduler.removeScheduledFunctionWithId(e)},r.prototype._setInterval=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=this._scheduler.nextId,s={onSuccess:null,onError:this._dequeuePeriodicTimer(i)},o=this._fnAndFlush(e,s);return s.onSuccess=this._requeuePeriodicTimer(o,t,r,i),this._scheduler.scheduleFunction(o,t,r),this.pendingPeriodicTimers.push(i),i},r.prototype._clearInterval=function(e){r._removeTimer(this.pendingPeriodicTimers,e),this._scheduler.removeScheduledFunctionWithId(e)},r.prototype._resetLastErrorAndThrow=function(){var e=this._lastError||this._uncaughtPromiseErrors[0];throw this._uncaughtPromiseErrors.length=0,this._lastError=null,e},r.prototype.tick=function(e){void 0===e&&(e=0),r.assertInZone(),this.flushMicrotasks(),this._scheduler.tick(e),null!==this._lastError&&this._resetLastErrorAndThrow()},r.prototype.flushMicrotasks=function(){var e=this;r.assertInZone();for(var t=function(){(null!==e._lastError||e._uncaughtPromiseErrors.length)&&e._resetLastErrorAndThrow()};this._microtasks.length>0;){var n=this._microtasks.shift();n()}t()},r.prototype.onScheduleTask=function(e,t,r,n){switch(n.type){case"microTask":this._microtasks.push(n.invoke);break;case"macroTask":switch(n.source){case"setTimeout":n.data.handleId=this._setTimeout(n.invoke,n.data.delay,n.data.args);break;case"setInterval":n.data.handleId=this._setInterval(n.invoke,n.data.delay,n.data.args);break;case"XMLHttpRequest.send":throw new Error("Cannot make XHRs from within a fake async test.");default:n=e.scheduleTask(r,n)}break;case"eventTask":n=e.scheduleTask(r,n)}return n},r.prototype.onCancelTask=function(e,t,r,n){switch(n.source){case"setTimeout":return this._clearTimeout(n.data.handleId);case"setInterval":return this._clearInterval(n.data.handleId);default:return e.cancelTask(r,n)}},r.prototype.onHandleError=function(e,t,r,n){return this._lastError=n,!1},r}();Zone.FakeAsyncTestZoneSpec=r}("object"==typeof window&&window||"object"==typeof self&&self||global)});