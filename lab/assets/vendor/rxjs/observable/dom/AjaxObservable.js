"use strict";function getCORSRequest(){if(root_1.root.XMLHttpRequest){var e=new root_1.root.XMLHttpRequest;return"withCredentials"in e&&(e.withCredentials=!!this.withCredentials),e}if(root_1.root.XDomainRequest)return new root_1.root.XDomainRequest;throw new Error("CORS is not supported by your browser")}function getXMLHttpRequest(){if(root_1.root.XMLHttpRequest)return new root_1.root.XMLHttpRequest;var e=void 0;try{for(var r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=0;t<3;t++)try{if(e=r[t],new root_1.root.ActiveXObject(e))break}catch(e){}return new root_1.root.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}function ajaxGet(e,r){return void 0===r&&(r=null),new AjaxObservable({method:"GET",url:e,headers:r})}function ajaxPost(e,r,t){return new AjaxObservable({method:"POST",url:e,body:r,headers:t})}function ajaxDelete(e,r){return new AjaxObservable({method:"DELETE",url:e,headers:r})}function ajaxPut(e,r,t){return new AjaxObservable({method:"PUT",url:e,body:r,headers:t})}function ajaxGetJSON(e,r){return new AjaxObservable({method:"GET",url:e,responseType:"json",headers:r}).lift(new map_1.MapOperator(function(e,r){return e.response},null))}var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},root_1=require("../../util/root"),tryCatch_1=require("../../util/tryCatch"),errorObject_1=require("../../util/errorObject"),Observable_1=require("../../Observable"),Subscriber_1=require("../../Subscriber"),map_1=require("../../operator/map");exports.ajaxGet=ajaxGet,exports.ajaxPost=ajaxPost,exports.ajaxDelete=ajaxDelete,exports.ajaxPut=ajaxPut,exports.ajaxGetJSON=ajaxGetJSON;var AjaxObservable=function(e){function r(r){e.call(this);var t={async:!0,createXHR:function(){return this.crossDomain?getCORSRequest.call(this):getXMLHttpRequest()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof r)t.url=r;else for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s]);this.request=t}return __extends(r,e),r.prototype._subscribe=function(e){return new AjaxSubscriber(e,this.request)},r.create=function(){var e=function(e){return new r(e)};return e.get=ajaxGet,e.post=ajaxPost,e.delete=ajaxDelete,e.put=ajaxPut,e.getJSON=ajaxGetJSON,e}(),r}(Observable_1.Observable);exports.AjaxObservable=AjaxObservable;var AjaxSubscriber=function(e){function r(r,t){e.call(this,r),this.request=t,this.done=!1;var s=t.headers=t.headers||{};t.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in s||root_1.root.FormData&&t.body instanceof root_1.root.FormData||"undefined"==typeof t.body||(s["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),t.body=this.serializeBody(t.body,t.headers["Content-Type"]),this.send()}return __extends(r,e),r.prototype.next=function(e){this.done=!0;var r=this,t=r.xhr,s=r.request,o=r.destination,n=new AjaxResponse(e,t,s);o.next(n)},r.prototype.send=function(){var e=this,r=e.request,t=e.request,s=t.user,o=t.method,n=t.url,a=t.async,i=t.password,u=t.headers,c=t.body,p=r.createXHR,b=tryCatch_1.tryCatch(p).call(r);if(b===errorObject_1.errorObject)this.error(errorObject_1.errorObject.e);else{this.xhr=b;var h=void 0;if(h=s?tryCatch_1.tryCatch(b.open).call(b,o,n,a,s,i):tryCatch_1.tryCatch(b.open).call(b,o,n,a),h===errorObject_1.errorObject)return this.error(errorObject_1.errorObject.e),null;b.timeout=r.timeout,b.responseType=r.responseType,this.setHeaders(b,u),this.setupEvents(b,r),c?b.send(c):b.send()}return b},r.prototype.serializeBody=function(e,r){if(!e||"string"==typeof e)return e;if(root_1.root.FormData&&e instanceof root_1.root.FormData)return e;if(r){var t=r.indexOf(";");t!==-1&&(r=r.substring(0,t))}switch(r){case"application/x-www-form-urlencoded":return Object.keys(e).map(function(r){return encodeURI(r)+"="+encodeURI(e[r])}).join("&");case"application/json":return JSON.stringify(e);default:return e}},r.prototype.setHeaders=function(e,r){for(var t in r)r.hasOwnProperty(t)&&e.setRequestHeader(t,r[t])},r.prototype.setupEvents=function(e,r){var t=r.progressSubscriber;e.ontimeout=function e(r){var t=e,s=t.subscriber,o=t.progressSubscriber,n=t.request;o&&o.error(r),s.error(new AjaxTimeoutError(this,n))},e.ontimeout.request=r,e.ontimeout.subscriber=this,e.ontimeout.progressSubscriber=t,e.upload&&"withCredentials"in e&&root_1.root.XDomainRequest&&(t&&(e.onprogress=function e(r){var t=e.progressSubscriber;t.next(r)},e.onprogress.progressSubscriber=t),e.onerror=function e(r){var t=e,s=t.progressSubscriber,o=t.subscriber,n=t.request;s&&s.error(r),o.error(new AjaxError("ajax error",this,n))},e.onerror.request=r,e.onerror.subscriber=this,e.onerror.progressSubscriber=t),e.onreadystatechange=function e(r){var t=e,s=t.subscriber,o=t.progressSubscriber,n=t.request;if(4===this.readyState){var a=1223===this.status?204:this.status,i="text"===this.responseType?this.response||this.responseText:this.response;0===a&&(a=i?200:0),200<=a&&a<300?(o&&o.complete(),s.next(r),s.complete()):(o&&o.error(r),s.error(new AjaxError("ajax error "+a,this,n)))}},e.onreadystatechange.subscriber=this,e.onreadystatechange.progressSubscriber=t,e.onreadystatechange.request=r},r.prototype.unsubscribe=function(){var r=this,t=r.done,s=r.xhr;!t&&s&&4!==s.readyState&&s.abort(),e.prototype.unsubscribe.call(this)},r}(Subscriber_1.Subscriber);exports.AjaxSubscriber=AjaxSubscriber;var AjaxResponse=function(){function e(e,r,t){switch(this.originalEvent=e,this.xhr=r,this.request=t,this.status=r.status,this.responseType=r.responseType||t.responseType,this.responseType){case"json":"response"in r?this.response=r.responseType?r.response:JSON.parse(r.response||r.responseText||"null"):this.response=JSON.parse(r.responseText||"null");break;case"xml":this.response=r.responseXML;break;case"text":default:this.response="response"in r?r.response:r.responseText}}return e}();exports.AjaxResponse=AjaxResponse;var AjaxError=function(e){function r(r,t,s){e.call(this,r),this.message=r,this.xhr=t,this.request=s,this.status=t.status}return __extends(r,e),r}(Error);exports.AjaxError=AjaxError;var AjaxTimeoutError=function(e){function r(r,t){e.call(this,"ajax timeout",r,t)}return __extends(r,e),r}(AjaxError);exports.AjaxTimeoutError=AjaxTimeoutError;