"use strict";var isArray_1=require("./util/isArray"),isObject_1=require("./util/isObject"),isFunction_1=require("./util/isFunction"),tryCatch_1=require("./util/tryCatch"),errorObject_1=require("./util/errorObject"),UnsubscriptionError_1=require("./util/UnsubscriptionError"),Subscription=function(){function r(r){this.closed=!1,r&&(this._unsubscribe=r)}return r.prototype.unsubscribe=function(){var r,i=!1;if(!this.closed){this.closed=!0;var t=this,s=t._unsubscribe,e=t._subscriptions;if(this._subscriptions=null,isFunction_1.isFunction(s)){var c=tryCatch_1.tryCatch(s).call(this);c===errorObject_1.errorObject&&(i=!0,(r=r||[]).push(errorObject_1.errorObject.e))}if(isArray_1.isArray(e))for(var n=-1,o=e.length;++n<o;){var u=e[n];if(isObject_1.isObject(u)){var c=tryCatch_1.tryCatch(u.unsubscribe).call(u);if(c===errorObject_1.errorObject){i=!0,r=r||[];var b=errorObject_1.errorObject.e;b instanceof UnsubscriptionError_1.UnsubscriptionError?r=r.concat(b.errors):r.push(b)}}}if(i)throw new UnsubscriptionError_1.UnsubscriptionError(r)}},r.prototype.add=function(i){if(!i||i===r.EMPTY)return r.EMPTY;if(i===this)return this;var t=i;switch(typeof i){case"function":t=new r(i);case"object":if(t.closed||"function"!=typeof t.unsubscribe)break;this.closed?t.unsubscribe():(this._subscriptions||(this._subscriptions=[])).push(t);break;default:throw new Error("unrecognized teardown "+i+" added to Subscription.")}return t},r.prototype.remove=function(i){if(null!=i&&i!==this&&i!==r.EMPTY){var t=this._subscriptions;if(t){var s=t.indexOf(i);s!==-1&&t.splice(s,1)}}},r.EMPTY=function(r){return r.closed=!0,r}(new r),r}();exports.Subscription=Subscription;