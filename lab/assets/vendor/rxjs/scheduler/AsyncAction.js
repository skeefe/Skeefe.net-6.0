"use strict";var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},root_1=require("../util/root"),Action_1=require("./Action"),AsyncAction=function(t){function i(i,e){t.call(this,i,e),this.scheduler=i,this.work=e,this.pending=!1}return __extends(i,t),i.prototype.schedule=function(t,i){if(void 0===i&&(i=0),this.closed)return this;this.state=t,this.pending=!0;var e=this.id,n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,i)),this.delay=i,this.id=this.id||this.requestAsyncId(n,this.id,i),this},i.prototype.requestAsyncId=function(t,i,e){return void 0===e&&(e=0),root_1.root.setInterval(t.flush.bind(t,this),e)},i.prototype.recycleAsyncId=function(t,i,e){return void 0===e&&(e=0),null!==e&&this.delay===e?i:root_1.root.clearInterval(i)&&void 0||void 0},i.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var e=this._execute(t,i);return e?e:void(this.pending===!1&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null)))},i.prototype._execute=function(t,i){var e=!1,n=void 0;try{this.work(t)}catch(t){e=!0,n=!!t&&t||new Error(t)}if(e)return this.unsubscribe(),n},i.prototype._unsubscribe=function(){var t=this.id,i=this.scheduler,e=i.actions,n=e.indexOf(this);this.work=null,this.delay=null,this.state=null,this.pending=!1,this.scheduler=null,n!==-1&&e.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(i,t,null))},i}(Action_1.Action);exports.AsyncAction=AsyncAction;