"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},Subject_1=require("./Subject"),queue_1=require("./scheduler/queue"),observeOn_1=require("./operator/observeOn"),ReplaySubject=function(e){function t(t,r,n){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this),this.scheduler=n,this._events=[],this._bufferSize=t<1?1:t,this._windowTime=r<1?1:r}return __extends(t,e),t.prototype.next=function(t){var r=this._getNow();this._events.push(new ReplayEvent(r,t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(t){var r=this._trimBufferThenGetEvents(),n=this.scheduler;n&&t.add(t=new observeOn_1.ObserveOnSubscriber(t,n));for(var i=r.length,u=0;u<i&&!t.closed;u++)t.next(r[u].value);return e.prototype._subscribe.call(this,t)},t.prototype._getNow=function(){return(this.scheduler||queue_1.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,i=n.length,u=0;u<i&&!(e-n[u].time<r);)u++;return i>t&&(u=Math.max(u,i-t)),u>0&&n.splice(0,u),n},t}(Subject_1.Subject);exports.ReplaySubject=ReplaySubject;var ReplayEvent=function(){function e(e,t){this.time=e,this.value=t}return e}();