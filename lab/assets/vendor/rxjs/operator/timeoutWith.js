"use strict";function timeoutWith(t,e,i){void 0===i&&(i=async_1.async);var s=isDate_1.isDate(t),r=s?+t-i.now():Math.abs(t);return this.lift(new TimeoutWithOperator(r,s,e,i))}var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},async_1=require("../scheduler/async"),isDate_1=require("../util/isDate"),OuterSubscriber_1=require("../OuterSubscriber"),subscribeToResult_1=require("../util/subscribeToResult");exports.timeoutWith=timeoutWith;var TimeoutWithOperator=function(){function t(t,e,i,s){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=i,this.scheduler=s}return t.prototype.call=function(t,e){return e._subscribe(new TimeoutWithSubscriber(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),TimeoutWithSubscriber=function(t){function e(e,i,s,r,o){t.call(this),this.destination=e,this.absoluteTimeout=i,this.waitFor=s,this.withObservable=r,this.scheduler=o,this.timeoutSubscription=void 0,this.index=0,this._previousIndex=0,this._hasCompleted=!1,e.add(this),this.scheduleTimeout()}return __extends(e,t),Object.defineProperty(e.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),e.dispatchTimeout=function(t){var e=t.subscriber,i=t.index;e.hasCompleted||e.previousIndex!==i||e.handleTimeout()},e.prototype.scheduleTimeout=function(){var t=this.index,i={subscriber:this,index:t};this.scheduler.schedule(e.dispatchTimeout,this.waitFor,i),this.index++,this._previousIndex=t},e.prototype._next=function(t){this.destination.next(t),this.absoluteTimeout||this.scheduleTimeout()},e.prototype._error=function(t){this.destination.error(t),this._hasCompleted=!0},e.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},e.prototype.handleTimeout=function(){if(!this.closed){var t=this.withObservable;this.unsubscribe(),this.destination.add(this.timeoutSubscription=subscribeToResult_1.subscribeToResult(this,t))}},e}(OuterSubscriber_1.OuterSubscriber);