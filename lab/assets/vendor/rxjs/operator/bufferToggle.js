"use strict";function bufferToggle(t,e){return this.lift(new BufferToggleOperator(t,e))}var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Subscription_1=require("../Subscription"),subscribeToResult_1=require("../util/subscribeToResult"),OuterSubscriber_1=require("../OuterSubscriber");exports.bufferToggle=bufferToggle;var BufferToggleOperator=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e._subscribe(new BufferToggleSubscriber(t,this.openings,this.closingSelector))},t}(),BufferToggleSubscriber=function(t){function e(e,r,s){t.call(this,e),this.openings=r,this.closingSelector=s,this.contexts=[],this.add(subscribeToResult_1.subscribeToResult(this,r))}return __extends(e,t),e.prototype._next=function(t){for(var e=this.contexts,r=e.length,s=0;s<r;s++)e[s].buffer.push(t)},e.prototype._error=function(e){for(var r=this.contexts;r.length>0;){var s=r.shift();s.subscription.unsubscribe(),s.buffer=null,s.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var r=e.shift();this.destination.next(r.buffer),r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,r,s,o){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector,r=e.call(this,t);r&&this.trySubscribe(r)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var r=t.buffer,s=t.subscription;this.destination.next(r),e.splice(e.indexOf(t),1),this.remove(s),s.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,r=[],s=new Subscription_1.Subscription,o={buffer:r,subscription:s};e.push(o);var i=subscribeToResult_1.subscribeToResult(this,t,o);!i||i.closed?this.closeBuffer(o):(i.context=o,this.add(i),s.add(i))},e}(OuterSubscriber_1.OuterSubscriber);