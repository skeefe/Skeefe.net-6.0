"use strict";function timeout(e,t,i){void 0===t&&(t=null),void 0===i&&(i=async_1.async);var r=isDate_1.isDate(e),o=r?+e-i.now():Math.abs(e);return this.lift(new TimeoutOperator(o,r,t,i))}var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},async_1=require("../scheduler/async"),isDate_1=require("../util/isDate"),Subscriber_1=require("../Subscriber");exports.timeout=timeout;var TimeoutOperator=function(){function e(e,t,i,r){this.waitFor=e,this.absoluteTimeout=t,this.errorToSend=i,this.scheduler=r}return e.prototype.call=function(e,t){return t._subscribe(new TimeoutSubscriber(e,this.absoluteTimeout,this.waitFor,this.errorToSend,this.scheduler))},e}(),TimeoutSubscriber=function(e){function t(t,i,r,o,s){e.call(this,t),this.absoluteTimeout=i,this.waitFor=r,this.errorToSend=o,this.scheduler=s,this.index=0,this._previousIndex=0,this._hasCompleted=!1,this.scheduleTimeout()}return __extends(t,e),Object.defineProperty(t.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),t.dispatchTimeout=function(e){var t=e.subscriber,i=e.index;t.hasCompleted||t.previousIndex!==i||t.notifyTimeout()},t.prototype.scheduleTimeout=function(){var e=this.index;this.scheduler.schedule(t.dispatchTimeout,this.waitFor,{subscriber:this,index:e}),this.index++,this._previousIndex=e},t.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},t.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},t.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},t.prototype.notifyTimeout=function(){this.error(this.errorToSend||new Error("timeout"))},t}(Subscriber_1.Subscriber);